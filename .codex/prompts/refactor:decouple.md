# 疎結合にして依存関係を減らす

## 目的

具体実装への直接依存を避け、差し替え・テスト・進化に強い構造にする。

## 適用場面

- 実装詳細（ORM/HTTPクライアント）に直依存
- テストで重いモック/スタブ連鎖が必要
- 継承で結合が強く、拡張が困難

## 基本ルール

- 抽象（インターフェース/ポート）に依存
- 外部詳細はアダプタで隔離
- 継承より合成（委譲）を優先

## 手順（最小リスク）

1. 依存の向きを可視化（呼び出し/被呼び出し）
2. 抽象I/Fを導入し呼び出し側を差し替え
3. 具体実装をアダプタとして後置

## 測定指標（改善確認）

- 実装→抽象のエッジ比率↑
- テストでの差し替え箇所↓、モック軽量化
- 置換（別DB/別HTTP）に要する修正箇所↓

## アンチパターン

- 形骸化したI/F（1実装専用の名寄せだけ）
- 抽象を増やすだけで依存向きが変わらない

## 関連タグ（refactor）

`refactor:decouple`（依存逆転・I/F分割・継承→合成）

## コミット例

```
refactor:decouple storage behind Repository interface
```
